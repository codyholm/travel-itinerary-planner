<div class="container py-5">
  <div class="row mb-4">
    <div class="col">
      <h1 class="display-5">
        <i class="bi bi-credit-card me-2"></i>Checkout
      </h1>
    </div>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    {{ errorMessage }}
  </div>

  <div class="row">
    <!-- Checkout Form -->
    <div class="col-lg-7">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Customer Information</h5>
        </div>
        <div class="card-body">
          <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="firstName" class="form-label">First Name *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="firstName"
                  formControlName="firstName"
                  [class.is-invalid]="isFieldInvalid('firstName')"
                >
                <div class="invalid-feedback">
                  First name is required (min 2 characters)
                </div>
              </div>
              <div class="col-md-6">
                <label for="lastName" class="form-label">Last Name *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="lastName"
                  formControlName="lastName"
                  [class.is-invalid]="isFieldInvalid('lastName')"
                >
                <div class="invalid-feedback">
                  Last name is required (min 2 characters)
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="address" class="form-label">Street Address *</label>
              <input 
                type="text" 
                class="form-control" 
                id="address"
                formControlName="address"
                [class.is-invalid]="isFieldInvalid('address')"
              >
              <div class="invalid-feedback">
                Address is required (min 5 characters)
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="country" class="form-label">Country *</label>
                <select 
                  class="form-select" 
                  id="country"
                  formControlName="country"
                  [class.is-invalid]="isFieldInvalid('country')"
                >
                  <option value="">Select a country</option>
                  <option *ngFor="let country of countries" [value]="country.id">
                    {{ country.country_name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  Please select a country
                </div>
              </div>
              <div class="col-md-6">
                <label for="division" class="form-label">State/Province *</label>
                <select 
                  class="form-select" 
                  id="division"
                  formControlName="division"
                  [class.is-invalid]="isFieldInvalid('division')"
                  [disabled]="divisions.length === 0"
                >
                  <option value="">Select a state/province</option>
                  <option *ngFor="let division of divisions" [value]="division.id">
                    {{ division.division_name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  Please select a state/province
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="postal_code" class="form-label">Postal Code *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="postal_code"
                  formControlName="postal_code"
                  [class.is-invalid]="isFieldInvalid('postal_code')"
                >
                <div class="invalid-feedback">
                  Postal code is required
                </div>
              </div>
              <div class="col-md-6">
                <label for="phone" class="form-label">Phone Number *</label>
                <input 
                  type="tel" 
                  class="form-control" 
                  id="phone"
                  formControlName="phone"
                  placeholder="1234567890"
                  [class.is-invalid]="isFieldInvalid('phone')"
                >
                <div class="invalid-feedback">
                  Phone must be 10-15 digits
                </div>
              </div>
            </div>

            <div class="d-grid gap-2">
              <button 
                type="submit" 
                class="btn btn-primary btn-lg"
                [disabled]="submitting"
              >
                <span *ngIf="!submitting">
                  <i class="bi bi-check-circle me-2"></i>Place Order
                </span>
                <span *ngIf="submitting">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Processing...
                </span>
              </button>
              <a href="/cart" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Back to Cart
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="col-lg-5">
      <div class="card shadow-sm sticky-summary">
        <div class="card-header bg-light">
          <h5 class="mb-0">Order Summary</h5>
        </div>
        <div class="card-body">
          <div *ngFor="let item of cartItems" class="mb-3 pb-3 border-bottom">
            <div class="d-flex">
              <img 
                [src]="item.vacation.image_URL" 
                [alt]="item.vacation.vacation_title"
                class="summary-image me-3"
                onerror="this.src='https://via.placeholder.com/80x60?text=Vacation'"
              >
              <div class="flex-grow-1">
                <h6 class="mb-1">{{ item.vacation.vacation_title }}</h6>
                <p class="text-muted small mb-1">${{ item.vacation.travel_price | number:'1.2-2' }}</p>
                <p *ngIf="item.excursions.length > 0" class="text-muted small mb-0">
                  + {{ item.excursions.length }} excursion(s)
                </p>
              </div>
            </div>
          </div>
          
          <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
            <strong class="h5 mb-0">Total:</strong>
            <strong class="h4 text-primary mb-0">${{ total | number:'1.2-2' }}</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
